add_custom_command(
    OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/colors.gperf
    COMMAND ${CMAKE_COMMAND} -E make_directory ${CMAKE_CURRENT_BINARY_DIR}/src
    COMMAND ${PYTHON3} ${CMAKE_SOURCE_DIR}/utils/cmake_helper.py convert-eol "${CMAKE_SOURCE_DIR}/contrib/libsvgtiny/src/colors.gperf" "${CMAKE_CURRENT_BINARY_DIR}/colors.gperf"
    DEPENDS ${CMAKE_SOURCE_DIR}/contrib/libsvgtiny/src/colors.gperf
)
add_custom_command(
    OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/src/autogenerated_colors.c
    COMMAND ${GPERF} ${CMAKE_CURRENT_BINARY_DIR}/colors.gperf --output-file=${CMAKE_CURRENT_BINARY_DIR}/src/autogenerated_colors.c
    DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/colors.gperf
)
add_custom_target(svgtiny_autogen DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/src/autogenerated_colors.c)

add_library(svgtiny SHARED
	src/svgtiny.c
	src/svgtiny_gradient.c
	src/svgtiny_list.c
	src/svgtiny_parse.c
	src/svgtiny_path.c
)
set_target_properties(svgtiny PROPERTIES SOVERSION ${NEOSURF_ABI})

add_dependencies(svgtiny svgtiny_autogen)

target_link_libraries(svgtiny nsutils dom m)

target_include_directories(svgtiny PRIVATE
	${CMAKE_SOURCE_DIR}/contrib/libsvgtiny/src
	${CMAKE_BINARY_DIR}/contrib/libsvgtiny/src
	${CMAKE_SOURCE_DIR}/contrib/libdom/bindings
)

install(TARGETS svgtiny
	RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
	LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
)
